# Relicta Configuration for Open Source Go Projects
# Optimized for GitHub releases, Homebrew distribution, and community engagement

versioning:
  strategy: "conventional"
  tag_prefix: "v"
  git_sign: {{ .GitSign }}
  auto_bump: true

changelog:
  file: "CHANGELOG.md"
  product_name: "{{ .ProjectName }}"
  {{- if .RepositoryURL }}
  repository_url: "{{ .RepositoryURL }}"
  {{- end }}
  sections:
    - title: "üöÄ Features"
      types: ["feat"]
    - title: "üêõ Bug Fixes"
      types: ["fix"]
    - title: "üìö Documentation"
      types: ["docs"]
    - title: "üîß Chores"
      types: ["chore", "ci", "build"]

{{- if .AIEnabled }}
ai:
  enabled: true
  provider: "{{ .AIProvider }}"
  {{- if .AIModel }}
  model: "{{ .AIModel }}"
  {{- end }}
  max_tokens: 2048
  temperature: 0.7
{{- end }}

plugins:
  {{- if .EnableGitHub }}
  - name: "github"
    enabled: true
    hooks: ["post_publish"]
    config:
      create_release: true
      draft: false
      prerelease: false
      generate_release_notes: true
      {{- if eq .BuildTool "goreleaser" }}
      assets:
        - "dist/*.tar.gz"
        - "dist/*.zip"
        - "dist/checksums.txt"
      {{- end }}
  {{- end }}

  {{- if .EnableHomebrew }}
  - name: "homebrew"
    enabled: true
    hooks: ["post_publish"]
    config:
      {{- if .HomebrewTap }}
      tap: "{{ .HomebrewTap }}"
      {{- else }}
      tap: "{{ extractOwner .RepositoryURL }}/homebrew-tap"
      {{- end }}
      formula_name: "{{ .ProjectName }}"
      description: "{{ .ProjectName }} - Release management tool"
      homepage: "{{ .RepositoryURL }}"
  {{- end }}

  {{- if .EnableSlack }}
  - name: "slack"
    enabled: true
    hooks: ["post_publish", "on_error"]
    config:
      webhook_url: "${SLACK_WEBHOOK_URL}"
      notify_on_success: true
      notify_on_error: true
      include_changelog: true
  {{- end }}

  {{- if .EnableDiscord }}
  - name: "discord"
    enabled: true
    hooks: ["post_publish"]
    config:
      webhook_url: "${DISCORD_WEBHOOK_URL}"
      notify_on_success: true
      include_changelog: true
  {{- end }}

  {{- if .EnableDocker }}
  - name: "docker"
    enabled: true
    hooks: ["post_publish"]
    config:
      {{- if .DockerRegistry }}
      registry: "{{ .DockerRegistry }}"
      {{- else }}
      registry: "ghcr.io"
      {{- end }}
      image_name: "{{ .ProjectName }}"
      platforms:
        - "linux/amd64"
        - "linux/arm64"
      tags:
        - "latest"
        - "{{ `{{ .Version }}` }}"
        - "{{ `{{ .Major }}.{{ .Minor }}` }}"
  {{- end }}

# Change Governance Protocol (CGP)
# Uncomment to enable release governance
# Recommended if using AI coding assistants (Claude, GPT, Copilot)
# governance:
#   enabled: true
#   strict_mode: false
#   auto_approve_threshold: 0.3
#   require_human_for_breaking: true
#   policy_dir: ".relicta/policies"
#   # For AI-assisted development: cp examples/policies/agent-aware.policy .relicta/policies/
