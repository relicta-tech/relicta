# Relicta Configuration for Monorepos
# Optimized for multi-package repositories with independent versioning

versioning:
  strategy: "conventional"
  tag_prefix: "v"
  git_sign: {{ .GitSign }}
  auto_bump: true
  independent: true  # Each package can have independent versions

changelog:
  file: "CHANGELOG.md"
  product_name: "{{ .ProjectName }}"
  {{- if .RepositoryURL }}
  repository_url: "{{ .RepositoryURL }}"
  {{- end }}
  sections:
    - title: "‚ú® Features"
      types: ["feat"]
    - title: "üêõ Bug Fixes"
      types: ["fix"]
    - title: "üì¶ Packages"
      types: ["package"]
    - title: "üîß Workspace"
      types: ["workspace"]

{{- if .AIEnabled }}
ai:
  enabled: true
  provider: "{{ .AIProvider }}"
  {{- if .AIModel }}
  model: "{{ .AIModel }}"
  {{- end }}
  max_tokens: 2048
  temperature: 0.7
{{- end }}

# Monorepo workspace configuration
workspace:
  packages:
    - "packages/*"
    - "apps/*"
  {{- if eq .Language "node" }}
  package_manager: "{{ .PackageManager }}"
  {{- end }}

plugins:
  {{- if .EnableGitHub }}
  - name: "github"
    enabled: true
    hooks: ["post_publish"]
    config:
      create_release: true
      draft: false
      prerelease: false
      generate_release_notes: true
      # Separate releases for each package
      release_per_package: true
  {{- end }}

  {{- if .EnableNPM }}
  - name: "npm"
    enabled: true
    hooks: ["post_publish"]
    config:
      {{- if .NPMRegistry }}
      registry: "{{ .NPMRegistry }}"
      {{- else }}
      registry: "https://registry.npmjs.org"
      {{- end }}
      access: "public"
      # Publish all changed packages
      publish_workspace: true
  {{- end }}

  {{- if .EnableDocker }}
  - name: "docker"
    enabled: true
    hooks: ["post_publish"]
    config:
      {{- if .DockerRegistry }}
      registry: "{{ .DockerRegistry }}"
      {{- else }}
      registry: "ghcr.io"
      {{- end }}
      # Build images for each app in apps/
      apps:
        - name: "web"
          dockerfile: "apps/web/Dockerfile"
          context: "."
        - name: "api"
          dockerfile: "apps/api/Dockerfile"
          context: "."
  {{- end }}

  {{- if .EnableSlack }}
  - name: "slack"
    enabled: true
    hooks: ["post_publish", "on_error"]
    config:
      webhook_url: "${SLACK_WEBHOOK_URL}"
      notify_on_success: true
      notify_on_error: true
      include_changelog: true
      # Group notifications by workspace
      group_by_workspace: true
  {{- end }}

  {{- if .EnableTeams }}
  - name: "teams"
    enabled: true
    hooks: ["post_publish", "on_error"]
    config:
      webhook_url: "${TEAMS_WEBHOOK_URL}"
      notify_on_success: true
      notify_on_error: true
      include_changelog: true
  {{- end }}

  {{- if .EnableJira }}
  - name: "jira"
    enabled: true
    hooks: ["post_publish"]
    config:
      {{- if .JiraProject }}
      project: "{{ .JiraProject }}"
      {{- else }}
      project: "MONO"
      {{- end }}
      base_url: "${JIRA_BASE_URL}"
      username: "${JIRA_USERNAME}"
      api_token: "${JIRA_API_TOKEN}"
      create_release: true
      update_issues: true
  {{- end }}
