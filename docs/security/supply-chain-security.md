# Supply Chain Security for Relicta Plugins

This document outlines the supply chain security measures implemented for Relicta and its plugins.

## Current Security Measures

### 1. SHA256 Checksum Verification
All plugin archives include SHA256 checksums that are verified **before extraction**:
- Checksums are stored in `plugins/registry.yaml`
- Verification occurs in `internal/plugin/manager/installer.go`
- Archives are rejected if checksums don't match

### 2. Archive Checksums (Not Binary)
Checksums are calculated for the release archives (`.tar.gz`, `.zip`), not the extracted binaries:
- More secure: validates the entire package integrity
- Matches checksums generated by release workflows
- Prevents tampering with any archive contents

## Enhanced Security Options

### Option 1: GitHub Artifact Attestations (Recommended)

GitHub's built-in artifact attestations provide:
- **Sigstore-based signing**: Keyless, using OIDC identity
- **SLSA Level 1 provenance**: Automatically generated
- **Easy implementation**: Single action addition
- **No key management**: Uses ephemeral Sigstore certificates

**Implementation**: Add `actions/attest-build-provenance` to release workflow.

**Verification**: Users can verify with `gh attestation verify`

### Option 2: SLSA Level 3 with slsa-github-generator

For maximum supply chain security:
- **SLSA Level 3 compliance**: Highest practical level
- **Isolated build environment**: Builds in GitHub's reusable workflow
- **Immutable provenance**: Cryptographically signed

**Trade-offs**:
- More complex workflow setup
- Requires reusable workflow pattern
- May impact build flexibility

### Option 3: GPG Signatures (Traditional)

Traditional approach with GPG keys:
- **Established ecosystem**: Widely understood
- **Offline verification**: No external service needed
- **Key management burden**: Requires secure key storage

**Trade-offs**:
- Manual key rotation
- Key distribution challenges
- Not integrated with CI/CD identity

## Recommended Implementation

We recommend **GitHub Artifact Attestations** because:
1. **Zero key management**: Uses Sigstore keyless signing
2. **Native GitHub integration**: Works with `gh` CLI
3. **SLSA Level 1 baseline**: Meets industry standards
4. **Simple adoption**: Single workflow change

## Verification Commands

### Verify Plugin Attestation
```bash
# Verify a downloaded plugin archive
gh attestation verify github_darwin_aarch64.tar.gz \
  --owner relicta-tech \
  --repo plugin-github

# Verify with specific artifact digest
gh attestation verify --digest sha256:CHECKSUM \
  --owner relicta-tech \
  --repo plugin-github
```

### Verify Relicta Binary
```bash
gh attestation verify relicta_Linux_x86_64.tar.gz \
  --owner relicta-tech \
  --repo relicta
```

## Implementation Status

| Security Measure | Status | Notes |
|-----------------|--------|-------|
| SHA256 Checksums | ✅ Implemented | Verified before extraction |
| Archive Checksums | ✅ Implemented | Not binary checksums |
| GitHub Attestations | ✅ Implemented | Using Sigstore keyless signing |
| SLSA Level 3 | ❌ Not planned | Complex for current needs |
| GPG Signatures | ❌ Not planned | Key management overhead |

## Workflow Files

### Main Relicta Release
- **File**: `.github/workflows/release.yaml`
- **Action**: `actions/attest-build-provenance@v2`
- **Artifacts**: All 5 platform archives

### Plugin Release Template
- **File**: `docs/security/plugin-release-workflow.yaml`
- **Usage**: Copy to plugin `.github/workflows/release.yaml`
- **Artifacts**: All 5 platform archives per plugin

## References

- [GitHub Artifact Attestations](https://docs.github.com/en/actions/security-for-github-actions/using-artifact-attestations)
- [SLSA Framework](https://slsa.dev/)
- [Sigstore](https://www.sigstore.dev/)
- [slsa-github-generator](https://github.com/slsa-framework/slsa-github-generator)
