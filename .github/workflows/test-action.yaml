name: Test Relicta Action

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Relicta version to test'
        required: false
        default: 'v2.0.0'

jobs:
  test-action:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Test Relicta Action
        uses: relicta-tech/relicta-action@v2
        with:
          version: ${{ github.event.inputs.version }}
          command: plan
          dry-run: 'true'
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Verify relicta is installed
        run: |
          which relicta || echo "relicta not in PATH"
          relicta version || echo "relicta command failed"
